<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Propose.ly | Special Message</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; background: #fff1f2; }
        .cursive { font-family: 'Dancing Script', cursive; }
        .hidden { display: none !important; }
        
        /* Floating Background */
        .emoji-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .emoji { position: absolute; bottom: -50px; animation: float 5s linear infinite; opacity: 0; font-size: 24px; }
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid white; }
        
        /* Premium Modal Animations */
        .modal-overlay { background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); }
        .modal-content { animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1); }
        @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .btn-hover { transition: all 0.3s ease; }
        .btn-hover:active { transform: scale(0.95); }

        /* Specific Hover Effects */
        .btn-accept:hover { background-color: #e11d48; transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(225, 29, 72, 0.4); }
        .btn-decline:hover { background-color: #fee2e2; color: #ef4444; transform: translateY(-1px); }
        .btn-note:hover { background-color: #f0f9ff; color: #0ea5e9; transform: translateY(-1px); }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDfgzJzDVOU2Zi3La8BMCKCdTPhyBeup_M",
            authDomain: "val-project-34b84.firebaseapp.com",
            projectId: "val-project-34b84",
            storageBucket: "val-project-34b84.firebasestorage.app",
            messagingSenderId: "247007134664",
            appId: "1:247007134664:web:6e75fc3ef833a53e9676fd",
            measurementId: "G-8CHL8H67RX"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const urlParams = new URLSearchParams(window.location.search);
        const proposalId = urlParams.get('id');

        async function loadProposal() {
            if (!proposalId) return;
            const docRef = doc(db, "proposals", proposalId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                const titleText = document.getElementById('proposal-title');
                
                // Grammar Fix Logic
                if (data.type === "Marriage") {
                    titleText.innerHTML = 'Will you <span class="text-rose-500">marry me</span>? üíç';
                } else {
                    titleText.innerHTML = 'Will you be my <span class="text-rose-500">Valentine</span>? ‚ù§Ô∏è';
                }

                document.getElementById('display-msg').innerText = `"${data.msg}"`;
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
            } else {
                document.body.innerHTML = "<div class='text-center p-10 font-bold text-rose-500'>Proposal not found!</div>";
            }
        }

        window.respond = async (status) => {
            const reason = document.getElementById('reason-input').value;
            const btn = event.currentTarget;
            btn.disabled = true;
            
            try {
                await updateDoc(doc(db, "proposals", proposalId), {
                    status: status,
                    reason: reason || ""
                });

                if(status === 'accepted') {
                    document.getElementById('modal-icon').innerText = "üíñ";
                    document.getElementById('modal-title').innerText = "It's a Yes!";
                    document.getElementById('modal-text').innerText = "Your partner will be notified immediately. How romantic!";
                } else {
                    document.getElementById('modal-icon').innerText = "ü•Äüíî";
                    document.getElementById('modal-title').innerText = "Response Sent";
                    document.getElementById('modal-text').innerText = "Your answer has been shared privately with your partner.";
                }

                document.getElementById('success-modal').classList.remove('hidden');
            } catch (err) {
                alert("Error: " + err.message);
                btn.disabled = false;
            }
        };

        loadProposal();
    </script>
</head>

<body class="min-h-screen flex items-center justify-center p-4">
    <div class="emoji-container" id="emoji-bg"></div>

    <div id="success-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 modal-overlay">
        <div class="bg-white w-full max-w-xs rounded-[2.5rem] p-8 text-center shadow-2xl modal-content">
            <div id="modal-icon" class="text-5xl mb-4">‚ú®</div>
            <h3 id="modal-title" class="text-xl font-black text-gray-800 mb-2">Sent!</h3>
            <p id="modal-text" class="text-gray-500 text-[11px] mb-6 leading-relaxed"></p>
            <button onclick="window.location.reload()" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-black text-xs uppercase tracking-widest shadow-lg active:scale-95 transition-all">Done</button>
        </div>
    </div>

    <div class="relative z-10 w-full max-w-sm glass rounded-[3rem] shadow-2xl overflow-hidden p-8 text-center min-h-[500px] flex flex-col justify-center">
        
        <div id="loading" class="animate-pulse text-rose-400 font-black uppercase text-xs tracking-widest">
            Opening your message...
        </div>

        <div id="content" class="hidden">
            <div class="w-24 h-24 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-5xl animate-bounce">üíù</span>
            </div>

            <h1 id="proposal-title" class="text-3xl font-black text-gray-800 mb-2 cursive">
                </h1>

            <div class="mb-8">
                <p id="display-msg" class="text-gray-500 italic text-sm px-4 leading-relaxed"></p>
            </div>

            <div class="space-y-4">
                <button onclick="respond('accepted')" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-black shadow-lg btn-hover btn-accept text-sm tracking-widest">
                    ACCEPT ‚ù§Ô∏è
                </button>

                <div class="flex flex-col gap-3">
                    <button onclick="respond('declined')" class="w-full bg-gray-50 text-gray-400 py-3 rounded-xl font-bold text-[11px] uppercase tracking-widest btn-hover btn-decline">
                        Decline üíî
                    </button>
                    
                    <button onclick="document.getElementById('note-box').classList.toggle('hidden')" class="w-full bg-gray-50 text-gray-400 py-3 rounded-xl font-bold text-[11px] uppercase tracking-widest btn-hover btn-note">
                        Add Note üìù
                    </button>
                </div>

                <div id="note-box" class="hidden pt-2 animate-fade-in">
                    <textarea id="reason-input" placeholder="Type a sweet reply or a reason (Optional)..." 
                        class="w-full p-3 bg-rose-50/50 rounded-xl text-xs border-none focus:ring-1 focus:ring-rose-200 placeholder-rose-300" rows="2"></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Emoji Rain
        const emojis = ['‚ù§Ô∏è', '‚ú®', 'üåπ', 'üíñ'];
        function createEmoji() {
            const e = document.createElement('div');
            e.className = 'emoji';
            e.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            e.style.left = Math.random() * 100 + 'vw';
            e.style.animationDuration = (Math.random() * 2 + 3) + 's';
            const container = document.getElementById('emoji-bg');
            if(container) container.appendChild(e);
            setTimeout(() => e.remove(), 5000);
        }
        setInterval(createEmoji, 400);
    </script>
</body>
</html>
